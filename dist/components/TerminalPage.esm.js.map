{"version":3,"file":"TerminalPage.esm.js","sources":["../../src/components/TerminalPage.tsx"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\r\nimport { Page, Header, Content } from '@backstage/core-components';\r\nimport { Terminal } from 'xterm';\r\nimport { FitAddon } from 'xterm-addon-fit';\r\nimport 'xterm/css/xterm.css';\r\n\r\nimport { useApi } from '@backstage/core-plugin-api';\r\nimport { configApiRef } from '@backstage/core-plugin-api';\r\n\r\nexport const TerminalPage = () => {\r\n  const configApi = useApi(configApiRef);\r\n  const websocketServer = configApi.getString('webterminal.baseUrl');\r\n\r\n  const terminalRef = useRef<HTMLDivElement>(null);\r\n  const socketRef = useRef<WebSocket | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (terminalRef.current) {\r\n      const terminal = new Terminal();\r\n      const fitAddon = new FitAddon();\r\n      terminal.loadAddon(fitAddon);\r\n\r\n      terminal.open(terminalRef.current);\r\n      fitAddon.fit();\r\n\r\n      terminal.writeln('Connecting to the server...');\r\n\r\n      // using ws or wss protocol to connect to the server\r\n      const socket = new WebSocket(websocketServer);\r\n      socketRef.current = socket;\r\n      \r\n      socket.onopen = () => {\r\n        console.log('WebSocket connection opened');\r\n      };\r\n\r\n      socket.onmessage = (event) => {\r\n        terminal.write(event.data);\r\n      };\r\n\r\n      terminal.onData((data) => {\r\n        socket.send(data);\r\n      });\r\n\r\n      const handleResize = () => fitAddon.fit();\r\n      window.addEventListener('resize', handleResize);\r\n\r\n      return () => {\r\n        window.removeEventListener('resize', handleResize);\r\n        socket.close();\r\n        terminal.dispose();\r\n      };\r\n    }\r\n    return undefined;\r\n  }, []);\r\n\r\n  return (\r\n    <Page themeId=\"tool\">\r\n      <Header\r\n        title=\"Welcome to WebTerminal in Backstage!\"\r\n        subtitle=\"this is a terminal page in backstage powered by xterm.js and websocket.\"\r\n      />\r\n      <Content>\r\n        <div ref={terminalRef} style={{ height: '100%', width: '100%' }} />\r\n      </Content>\r\n    </Page>\r\n  );\r\n};\r\n\r\nexport default TerminalPage;\r\n"],"names":[],"mappings":";;;;;;;AASO,MAAM,eAAe,MAAM;AAChC,EAAM,MAAA,SAAA,GAAY,OAAO,YAAY,CAAA,CAAA;AACrC,EAAM,MAAA,eAAA,GAAkB,SAAU,CAAA,SAAA,CAAU,qBAAqB,CAAA,CAAA;AAEjE,EAAM,MAAA,WAAA,GAAc,OAAuB,IAAI,CAAA,CAAA;AAC/C,EAAM,MAAA,SAAA,GAAY,OAAyB,IAAI,CAAA,CAAA;AAE/C,EAAA,SAAA,CAAU,MAAM;AACd,IAAA,IAAI,YAAY,OAAS,EAAA;AACvB,MAAM,MAAA,QAAA,GAAW,IAAI,QAAS,EAAA,CAAA;AAC9B,MAAM,MAAA,QAAA,GAAW,IAAI,QAAS,EAAA,CAAA;AAC9B,MAAA,QAAA,CAAS,UAAU,QAAQ,CAAA,CAAA;AAE3B,MAAS,QAAA,CAAA,IAAA,CAAK,YAAY,OAAO,CAAA,CAAA;AACjC,MAAA,QAAA,CAAS,GAAI,EAAA,CAAA;AAEb,MAAA,QAAA,CAAS,QAAQ,6BAA6B,CAAA,CAAA;AAG9C,MAAM,MAAA,MAAA,GAAS,IAAI,SAAA,CAAU,eAAe,CAAA,CAAA;AAC5C,MAAA,SAAA,CAAU,OAAU,GAAA,MAAA,CAAA;AAEpB,MAAA,MAAA,CAAO,SAAS,MAAM;AACpB,QAAA,OAAA,CAAQ,IAAI,6BAA6B,CAAA,CAAA;AAAA,OAC3C,CAAA;AAEA,MAAO,MAAA,CAAA,SAAA,GAAY,CAAC,KAAU,KAAA;AAC5B,QAAS,QAAA,CAAA,KAAA,CAAM,MAAM,IAAI,CAAA,CAAA;AAAA,OAC3B,CAAA;AAEA,MAAS,QAAA,CAAA,MAAA,CAAO,CAAC,IAAS,KAAA;AACxB,QAAA,MAAA,CAAO,KAAK,IAAI,CAAA,CAAA;AAAA,OACjB,CAAA,CAAA;AAED,MAAM,MAAA,YAAA,GAAe,MAAM,QAAA,CAAS,GAAI,EAAA,CAAA;AACxC,MAAO,MAAA,CAAA,gBAAA,CAAiB,UAAU,YAAY,CAAA,CAAA;AAE9C,MAAA,OAAO,MAAM;AACX,QAAO,MAAA,CAAA,mBAAA,CAAoB,UAAU,YAAY,CAAA,CAAA;AACjD,QAAA,MAAA,CAAO,KAAM,EAAA,CAAA;AACb,QAAA,QAAA,CAAS,OAAQ,EAAA,CAAA;AAAA,OACnB,CAAA;AAAA,KACF;AACA,IAAO,OAAA,KAAA,CAAA,CAAA;AAAA,GACT,EAAG,EAAE,CAAA,CAAA;AAEL,EACE,uBAAA,KAAA,CAAA,aAAA,CAAC,IAAK,EAAA,EAAA,OAAA,EAAQ,MACZ,EAAA,kBAAA,KAAA,CAAA,aAAA;AAAA,IAAC,MAAA;AAAA,IAAA;AAAA,MACC,KAAM,EAAA,sCAAA;AAAA,MACN,QAAS,EAAA,yEAAA;AAAA,KAAA;AAAA,GAEX,kBAAA,KAAA,CAAA,aAAA,CAAC,OACC,EAAA,IAAA,kBAAA,KAAA,CAAA,aAAA,CAAC,SAAI,GAAK,EAAA,WAAA,EAAa,KAAO,EAAA,EAAE,QAAQ,MAAQ,EAAA,KAAA,EAAO,MAAO,EAAA,EAAG,CACnE,CACF,CAAA,CAAA;AAEJ;;;;"}